/*!
    Title: Dev Portfolio Template
    Version: 1.2.2
    Last Change: 03/25/2020
    Author: Ryan Fitzgerald
    Repo: https://github.com/RyanFitzgerald/devportfolio-template
    Issues: https://github.com/RyanFitzgerald/devportfolio-template/issues

    Description: This file contains all the scripts associated with the single-page
    portfolio website.
*/

!function(n) {
    // Remueve la clase "no-js" del elemento html al cargar la página
    n("html").removeClass("no-js");

    // Desplaza suavemente a las secciones correspondientes al hacer clic en los enlaces del encabezado
    n("header a").click(function(e) {
        if (!n(this).hasClass("no-scroll")) {
            e.preventDefault();
            var t = n(this).attr("href"),
                i = n(t).offset().top;
                var velocidad = +Math.abs(window.pageYOffset - n(t).offset().top) * 0.3; // Increase the 0.5 in case you want to decrease velocity 
            n("html, body").animate({
                scrollTop: i + "px"
            }, velocidad); // Línea que controla velocidad de desplazamiento 
            n("header").hasClass("active") && n("header, body").removeClass("active");
        }
    });

    // Desplaza suavemente hacia arriba al hacer clic en el botón de "Ir arriba"
    n("#to-top").click(function() {
        n("html, body").animate({
            scrollTop: 0
        }, 500);
    });

    // Desplaza suavemente a la siguiente sección al hacer clic en la flecha hacia abajo en la sección principal
    n("#lead-down span").click(function() {
        var e = n("#lead").next().offset().top;
        n("html, body").animate({
            scrollTop: e + "px"
        }, 500);
    });

    // Configura la estructura y estilo de la línea de tiempo de la experiencia
    n("#experience-timeline").each(function() {
        $this = n(this),
        $userContent = $this.children("div"),
        $userContent.each(function() {
            n(this).addClass("vtimeline-content").wrap('<div class="vtimeline-point"><div class="vtimeline-block"></div></div>');
        }),
        $this.find(".vtimeline-point").each(function() {
            n(this).prepend('<div class="vtimeline-icon"><i class="fa fa-map-marker"></i></div>');
        }),
        $this.find(".vtimeline-content").each(function() {
            var e = n(this).data("date");
            e && n(this).parent().prepend('<span class="vtimeline-date">' + e + "</span>");
        });
    });

    // Abre el menú móvil al hacer clic en el botón de apertura
    n("#mobile-menu-open").click(function() {
        n("header, body").addClass("active");
    });

    // Cierra el menú móvil al hacer clic en el botón de cierre
    n("#mobile-menu-close").click(function() {
        n("header, body").removeClass("active");
    });

    // Oculta el botón "Ver más proyectos" y muestra más proyectos al hacer clic en él
    n("#view-more-projects").click(function(e) {
        e.preventDefault();
        n(this).fadeOut(300, function() {
            n("#more-projects").fadeIn(300);
        });
    });
}(jQuery);

// Languages 
const flagsElement = document.getElementById("flags");
const textsToChange = document.querySelectorAll("[data-section]");

const changeLanguage = async (language) => {

    const requestJson = await fetch (`https://floatingbit23.github.io/languages/${language}.json`);
    const texts = await requestJson.json();

    for(const textToChange of textsToChange){
        const section = textToChange.dataset.section;
        const value = textToChange.dataset.value;
        textToChange.innerHTML = texts[section][value];
    }
};

// Flags
flagsElement.addEventListener("click", (e) => {
    changeLanguage(e.target.parentElement.dataset.language);
});

// Dark/Light Button

var icon = document.getElementById("icon");
var icon2 = document.getElementById("icon2");

if(localStorage.getItem("theme") == null){
    localStorage.setItem("theme", "dark");
 }

let localData = localStorage.getItem("theme");

// if-else PC
if(localData == "light"){
    icon.src = "https://floatingbit23.github.io/images/moon.svg";
    document.body.classList.add("dark-theme");
} else if(localData == "dark"){
    icon.src = "https://floatingbit23.github.io/images/sun.svg";
    document.body.classList.add("dark-theme");
}

// if-else MOBILE
if(localData == "light"){
    icon2.src = "https://floatingbit23.github.io/images/moon.svg";
    document.body.classList.add("dark-theme");
} else if(localData == "dark"){
    icon2.src = "https://floatingbit23.github.io/images/sun.svg";
    document.body.classList.add("dark-theme");
}

// Function PC
icon.onpointerdown = function(){
    document.body.classList.toggle("dark-theme");

        if( document.body.classList.contains("dark-theme") ){
            icon.src = "https://floatingbit23.github.io/images/sun.svg";
            localStorage.setItem("theme", "dark");
        } else {
            icon.src = "https://floatingbit23.github.io/images/moon.svg";
            localStorage.setItem("theme", "light");
        }
}

// Function MOBILE
icon2.onpointerdown = function(){
    document.body.classList.toggle("dark-theme");

        if( document.body.classList.contains("dark-theme") ){
            icon2.src = "https://floatingbit23.github.io/images/sun.svg";
            localStorage.setItem("theme", "dark");
        } else {
            icon2.src = "https://floatingbit23.github.io/images/moon.svg";
            localStorage.setItem("theme", "light");
        }
}

// ------------------------------------------------------------------------

function abrirVentana(url) {
    // Abrir una ventana emergente con un tamaño específico
    var ventana = window.open('', '_blank', 'width=600,height=400');
    // Cargar el contenido de la página en la ventana
    ventana.location.href = url;
  }

  // IMAGE SLIDER SCRIPT
const slides = document.querySelectorAll(".slides img");
let slideIndex = 0;
let intervalId = null;
document.addEventListener("DOMContentLoaded", initializeSlider);

function initializeSlider(){
    if(slides.length > 0){
        slides[slideIndex].classList.add("displaySlide");
        intervalId = setInterval(nextSlide, 5000);
    }
}

function showSlide(index){

    if(index >= slides.length){
        slideIndex = 0;
    } else if(index < 0){
        slideIndex = slides.length - 1;
    }

    slides.forEach(slide => {
        slide.classList.remove("displaySlide");
    });
    slides[slideIndex].classList.add("displaySlide");
}

function prevSlide(){
    clearInterval(intervalId);
    slideIndex--;
    showSlide(slideIndex);
}

function nextSlide(){
    slideIndex++;
    showSlide(slideIndex);
}

    // Función JavaScript (para agregar o quitar la clase CSS al menú según sea necesario)
    window.addEventListener('scroll', function() {

        var main = document.getElementById("mainmenu");
        var menu = document.getElementById("menu");

        if (window.scrollY > 500) { // Cambia 100 por la cantidad de desplazamiento que desees
            menu.classList.add("visible");
            main.classList.add("fixed-menu-style"); // Agrega la clase CSS para el menú fijo
        } else {
            main.classList.remove("fixed-menu-style"); // Quita la clase CSS para el menú fijo
            menu.classList.remove("visible");
        }

    });
    
    // Función para mostrar o no la sección #lead
    // NO se mostrará en el menú principal, pero SÍ en el lateral
    window.addEventListener('scroll', function() {
        var leadLink = document.querySelector(' #menu a[href="#lead"] ').parentNode;
        if (window.scrollY > 500) { // Cambia 100 por el valor de desplazamiento que desees
            leadLink.style.display = 'block'; // Mostrar el elemento
        } else {
            leadLink.style.display = 'none'; // Ocultar el elemento
        }
    });


    // Función para animar el icono de Experience
function animateIcon() {
    const icon = document.querySelector('.vtimeline-icon');
    icon.style.transform = 'scale(0.9)';
    setTimeout(() => icon.style.transform = 'scale(1.1)', 200);
}

// Función para redirigir al usuario cuando hace clic en el icono
function redirectToPage() {
    window.open('https://www.santomera.es', '_blank'); // URL de la página a la que deseas dirigir al usuario
}

// Función para manejar el clic en el icono
function handleIconClick(event) {
    // Verificar si el clic ocurrió en el icono
    if (event.target.classList.contains('vtimeline-icon')) {
        redirectToPage();
    }
}

// Obtener el botón del icono
var iconButton = document.querySelector('.vtimeline-icon');

// Agregar event listener al botón del icono
iconButton.addEventListener('click', handleIconClick);


// Función para manejar el clic en el icono
function handleIconClick2(event) {
    // Verificar si el clic ocurrió en el icono de Font Awesome con la clase 'fa-marker'
    if (event.target.classList.contains('fa-marker')) {
        redirectToPage();
    }
}

// Obtener el icono de Font Awesome con la clase 'fa-marker'
var icon2 = document.querySelector('.fa-map-marker');

// Agregar event listener al icono
icon2.addEventListener('click', handleIconClick2);